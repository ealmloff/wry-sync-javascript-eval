class JSHeap{slots;freeIds;maxId;constructor(){this.slots=[],this.slots[129]=null,this.slots[130]=!0,this.slots[131]=!1,this.slots[128]=void 0,this.freeIds=[],this.maxId=132}insert(value){let id;if(this.freeIds.length>0)id=this.freeIds.pop(),console.log("[JS Heap] insert (reused id):",id,"value:",value);else id=this.maxId,this.maxId++,console.log("[JS Heap] insert (new id):",id,"value:",value);return this.slots[id]=value,id}get(id){return this.slots[id]}remove(id){if(id<132)return console.log("[JS Heap] remove (reserved, skipping):",id),this.slots[id];let value=this.slots[id];if(value!==void 0)console.log("[JS Heap] remove:",id,"value:",value),this.slots[id]=void 0,this.freeIds.push(id);else console.log("[JS Heap] remove (already empty):",id);return value}has(id){return this.slots[id]!==void 0}}class DataEncoder{u8Buf;u16Buf;u32Buf;strBuf;constructor(){this.u8Buf=[],this.u16Buf=[],this.u32Buf=[],this.strBuf=[]}pushU8(value){this.u8Buf.push(value&255)}pushU16(value){this.u16Buf.push(value&65535)}pushU32(value){this.u32Buf.push(value>>>0)}pushU64(value){let low=value>>>0,high=Math.floor(value/4294967296)>>>0;this.pushU32(low),this.pushU32(high)}pushStr(value){let encoded=new TextEncoder().encode(value);this.pushU32(encoded.length);for(let i=0;i<encoded.length;i++)this.strBuf.push(encoded[i])}finalize(){let u16Offset=12+this.u32Buf.length*4,u8Offset=u16Offset+this.u16Buf.length*2,strOffset=u8Offset+this.u8Buf.length,totalSize=strOffset+this.strBuf.length,buffer=new ArrayBuffer(totalSize),dataView=new DataView(buffer);dataView.setUint32(0,u16Offset,!0),dataView.setUint32(4,u8Offset,!0),dataView.setUint32(8,strOffset,!0);let offset=12;for(let val of this.u32Buf)dataView.setUint32(offset,val,!0),offset+=4;for(let val of this.u16Buf)dataView.setUint16(offset,val,!0),offset+=2;return new Uint8Array(buffer,u8Offset,this.u8Buf.length).set(this.u8Buf),new Uint8Array(buffer,strOffset,this.strBuf.length).set(this.strBuf),buffer}}class DataDecoder{u8Buf;u8Offset;u16Buf;u16Offset;u32Buf;u32Offset;strBuf;strOffset;constructor(data){let headerView=new DataView(data,0,12),u16ByteOffset=headerView.getUint32(0,!0),u8ByteOffset=headerView.getUint32(4,!0),strByteOffset=headerView.getUint32(8,!0),u32ByteLength=u16ByteOffset-12;this.u32Buf=new Uint32Array(data,12,u32ByteLength/4),this.u32Offset=0;let u16ByteLength=u8ByteOffset-u16ByteOffset;this.u16Buf=new Uint16Array(data,u16ByteOffset,u16ByteLength/2),this.u16Offset=0;let u8ByteLength=strByteOffset-u8ByteOffset;this.u8Buf=new Uint8Array(data,u8ByteOffset,u8ByteLength),this.u8Offset=0;let strBuf=new Uint8Array(data,strByteOffset);this.strBuf=new TextDecoder("utf-8").decode(strBuf),this.strOffset=0}takeU8(){return this.u8Buf[this.u8Offset++]}takeU16(){return this.u16Buf[this.u16Offset++]}takeU32(){return this.u32Buf[this.u32Offset++]}hasMoreU32(){return this.u32Offset<this.u32Buf.length}takeU64(){let low=this.takeU32(),high=this.takeU32();return low+high*4294967296}takeStr(){let len=this.takeU32(),str=this.strBuf.substring(this.strOffset,this.strOffset+len);return this.strOffset+=len,str}}var DROP_HEAP_REF_FN_ID=4294967295,CLONE_HEAP_REF_FN_ID=4294967294,DROP_NATIVE_REF_FN_ID=4294967295;function sync_request_binary(endpoint,data){let xhr=new XMLHttpRequest;xhr.open("POST",endpoint,!1),xhr.responseType="arraybuffer";let bytes=new Uint8Array(data),binary="";for(let i=0;i<bytes.length;i++)binary+=String.fromCharCode(bytes[i]);let base64=btoa(binary);if(xhr.setRequestHeader("dioxus-data",base64),xhr.send(),xhr.status===200&&xhr.response&&xhr.response.byteLength>0)return xhr.response;return null}function evaluate_from_rust_binary(dataBase64){let binary=atob(dataBase64),bytes=new Uint8Array(binary.length);for(let i=0;i<binary.length;i++)bytes[i]=binary.charCodeAt(i);return handleBinaryResponse(bytes.buffer)}function handleBinaryResponse(response){if(!response||response.byteLength===0)return null;let decoder=new DataDecoder(response),msgType=decoder.takeU8();if(msgType===1)return decoder;else if(msgType===0){let encoder=new DataEncoder;encoder.pushU8(1);while(decoder.hasMoreU32()){let fnId=decoder.takeU32();if(fnId===DROP_HEAP_REF_FN_ID){let heapId=decoder.takeU64();window.jsHeap.remove(heapId);continue}if(fnId===CLONE_HEAP_REF_FN_ID){let heapId=decoder.takeU64(),value=window.jsHeap.get(heapId),newId=window.jsHeap.insert(value);encoder.pushU64(newId);continue}let spec=window.functionRegistry[fnId];if(!spec)throw new Error("Unknown function ID in response: "+fnId);spec(decoder,encoder)}let nextResponse=sync_request_binary("wry://handler",encoder.finalize());return handleBinaryResponse(nextResponse)}return null}var nativeRefRegistry=new FinalizationRegistry((fnId)=>{let encoder=new DataEncoder;encoder.pushU8(0),encoder.pushU32(DROP_NATIVE_REF_FN_ID),encoder.pushU64(fnId);let response=sync_request_binary("wry://handler",encoder.finalize());handleBinaryResponse(response)});class RustFunction{fnId;paramTypes;returnType;constructor(fnId,paramTypes,returnType){this.fnId=fnId,this.paramTypes=paramTypes,this.returnType=returnType,nativeRefRegistry.register(this,fnId)}call(...args){let encoder=new DataEncoder;encoder.pushU8(0),encoder.pushU32(0),encoder.pushU64(this.fnId);for(let i=0;i<this.paramTypes.length;i++)this.paramTypes[i].encode(encoder,args[i]);let response=sync_request_binary("wry://handler",encoder.finalize()),result=handleBinaryResponse(response);return this.returnType.decode(result)}}class BoolType{encode(encoder,value){encoder.pushU8(value?1:0)}decode(decoder){return decoder.takeU8()!==0}}class HeapRefType{encode(encoder,obj){let id=window.jsHeap.insert(obj);encoder.pushU64(id)}decode(decoder){let id=decoder.takeU64();return window.jsHeap.get(id)}}class StringType{encode(encoder,value){encoder.pushStr(value)}decode(decoder){return decoder.takeStr()}}class CallbackType{paramTypes;returnType;constructor(paramTypes,returnType){this.paramTypes=paramTypes,this.returnType=returnType}encode(encoder,fnId){encoder.pushU64(fnId)}decode(decoder){let fnId=decoder.takeU64(),f=new RustFunction(fnId,this.paramTypes,this.returnType);return(...args)=>f.call(...args)}}class NullType{encode(encoder,value){}decode(decoder){return null}}class NumericType{size;constructor(size){this.size=size}encode(encoder,value){switch(this.size){case"u8":encoder.pushU8(value);break;case"u16":encoder.pushU16(value);break;case"u32":encoder.pushU32(value);break;case"u64":encoder.pushU64(value);break}}decode(decoder){switch(this.size){case"u8":return decoder.takeU8();case"u16":return decoder.takeU16();case"u32":return decoder.takeU32();case"u64":return decoder.takeU64()}}}class OptionType{wrappedType;constructor(wrappedType){this.wrappedType=wrappedType}encode(encoder,value){if(value===null||value===void 0)encoder.pushU8(0);else encoder.pushU8(1),this.wrappedType.encode(encoder,value)}decode(decoder){if(decoder.takeU8()===0)return null;else return this.wrappedType.decode(decoder)}}function createWrapperFunction(paramTypes,returnType,jsFunction){return(decoder,encoder)=>{let params=paramTypes.map((paramType)=>paramType.decode(decoder)),result=jsFunction(...params);returnType.encode(encoder,result)}}var U8Type=new NumericType("u8"),U16Type=new NumericType("u16"),U32Type=new NumericType("u32"),U64Type=new NumericType("u64"),strType=new StringType;var functionRegistry=[];window.setFunctionRegistry=(registry)=>{functionRegistry=registry};window.evaluate_from_rust_binary=evaluate_from_rust_binary;window.jsHeap=new JSHeap;window.createWrapperFunction=createWrapperFunction;window.BoolType=BoolType;window.HeapRefType=HeapRefType;window.NullType=NullType;window.OptionType=OptionType;window.CallbackType=CallbackType;window.U8Type=U8Type;window.U16Type=U16Type;window.U32Type=U32Type;window.U64Type=U64Type;
